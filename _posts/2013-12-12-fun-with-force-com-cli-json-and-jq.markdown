---
layout: post
title:  Fun with Force.com CLI, JSON and .jq
description: We are terminal junkies at CloudSpokes so we were really excited when the  Force.com CLI was announced. One of our favorite command line tools is .jq , a lightweight and flexible command-line JSON processor. My buddy and terminal Yoda, Kyle Bowerman , turned me on to this utility. jq is like sed for JSON data  you can use it to slice and filter and map and transform structured data with the same ease as sed, awk, grep. So how does this work with Salesforce you ask? You can make virtually any ca
date: 2013-12-12 20:49:55 +0300
image:  '/images/slugs/fun-with-force-com-cli-json-and-jq.jpg'
tags:   ["salesforce"]
---
<p>We are terminal junkies at CloudSpokes so we were really excited when the <a href="https://force-cli.heroku.com/">Force.com CLI</a> was announced. One of our favorite command line tools is <a href="http://stedolan.github.io/jq/">.jq</a>, a lightweight and flexible command-line JSON processor. My buddy and terminal Yoda, <a href="https://twitter.com/kylebowerman">Kyle Bowerman</a>, turned me on to this utility. jq is like sed for JSON data  you can use it to slice and filter and map and transform structured data with the same ease as sed, awk, grep.</p>
<p>So how does this work with Salesforce you ask? You can make virtually any call that returns JSON (let's say a REST API query), search through the JSON, pipe the results into a shell script and then run that with the Force.com CLI.</p>
<p>The first thing you need to do is <a href="http://stedolan.github.io/jq/download/">install .jq</a>. Not terribly hard as they have binaries for most systems. Then you'll need to get a session token for the REST API call. You'll need to pass this session Id in the header with each REST call. Log into the <a href="http://workbench.developerforce.com">Workbench</a> for your org and go to Info -> Session Information. You'll see your session Id under the Connection folder.</p>
<p>So the simplest use case is to query for 3 accounts and run them through .jq to see what we get:</p>
<p><code>curl <a href="https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3">https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3</a> -H 'Authorization: Bearer [YOUR-SESSION-ID]' | jq '.'</code></p>
<p><a href="http://res.cloudinary.com/blog-jeffdouglas-com/image/upload/v1400327581/jq1_ucpbai.png"><img src="http://res.cloudinary.com/blog-jeffdouglas-com/image/upload/v1400327581/jq1_ucpbai.png" alt="jq1" width="500" class="alignnone size-full wp-image-5139" /></a></p>
<p>So let's say now that you want to get just the Names for all of these records. These are stored in the 'records' property so we are gonna tell .jq to iterate over the records array and just output the Name property:</p>
<p><code>curl <a href="https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3">https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3</a> -H 'Authorization: Bearer [YOUR-SESSION-ID]' | jq '.records[].Name'</code></p>
<p><a href="http://res.cloudinary.com/blog-jeffdouglas-com/image/upload/v1400327580/jq2_ujmyfu.png"><img src="http://res.cloudinary.com/blog-jeffdouglas-com/image/upload/v1400327580/jq2_ujmyfu.png" alt="jq2" width="500" class="alignnone size-full wp-image-5140" /></a></p>
<p>Now here's where the fun stuff begins. Let's use .jq to create a shell script to run with the Force.com CLI to update some records:</p>
<p><code>curl <a href="https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3">https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3</a> -H 'Authorization: Bearer [YOUR-SESSION-ID]' | jq '"force record update Account (.records[].Id) State:NY"'</code></p>
<p><a href="http://res.cloudinary.com/blog-jeffdouglas-com/image/upload/v1400327579/jq3_yosoiv.png"><img src="http://res.cloudinary.com/blog-jeffdouglas-com/image/upload/v1400327579/jq3_yosoiv.png" alt="jq3" width="500" class="alignnone size-full wp-image-5141" /></a></p>
<p>You can easily send the contents generated by .jq to a shell script that you can execute against your org by appending '> my_script.sh':</p>
<p><code>curl <a href="https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3">https://na5.salesforce.com/services/data/v29.0/query?q=select+name,+id+from+account+order+by+id+limit+3</a> -H 'Authorization: Bearer [YOUR-SESSION-ID]' | jq '"force record update Account (.records[].Id) State:NY"' > my_script.sh</code></p>
<p>There are a ton of things you can do with .jq so make sure you <a href="http://stedolan.github.io/jq/manual/">check out the manual</a>. Happy scripting! Enjoy!</p>

